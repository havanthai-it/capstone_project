<mat-card class="mat-card">
  <mat-sidenav-container class="mat-drawer-container">
    <mat-sidenav #drawer class="mat-drawer mat-sidenav mat-drawer-side" mode="side" opened="true" position="start">
      <div class="mat-drawer-inner-container">
        <mat-toolbar class="mat-toolbar-single-row">
          <div>
            <span>
              <img class="img-circle" src="{{user.avatar}}">
              <span>{{user.displayName}}</span>
            </span>
          </div>
        </mat-toolbar>
        <mat-nav-list>
          <div *ngFor="let conv of listConversations">
            <mat-list-item
              [ngClass]="{'chat-user-item': true, 'user-item-selected': conv.id == selectedConversation.id}"
              (click)="onClickUserItem(conv)">
              <img class="mat-list-avatar" src="{{conv.avatar}}">
              <div class="mat-list-text">
                <h3 class="mat-line" matline="">{{conv.name}}</h3>
                <p class="text text-muted mat-line" matline="">
                  {{isImage(conv.lastMessage.content) ? '' : conv.lastMessage.content}}
                </p>
              </div>
            </mat-list-item>
          </div>
        </mat-nav-list>
      </div>
    </mat-sidenav>
    <mat-sidenav-content class="mat-drawer-content">
      <!-- chat-header -->
      <mat-toolbar class="mat-toolbar-single-row">
        <div>
          <button class="mat-icon-button" (click)="drawer.toggle()">
            <span class="mat-button-wrapper">
              <mat-icon>short_text</mat-icon>
            </span>
          </button>
          <span>
            <img class="img-circle" src="{{selectedConversation.avatar}}">
            {{selectedConversation.name}}
          </span>
        </div>
      </mat-toolbar>

      <!-- chat-content -->
      <mat-card-content class="chat-middle-box">
        <div class="row">
          <div class="col-lg-9">
            <div #chatContainer [scrollTop]="chatContainer.scrollHeight" class="chat-content-container"
              [style.height.px]="chatContentHeight">
              <div *ngFor="let message of this.selectedConversation.messages">
                <div *ngIf="user.id != message.fromUserId" class="chat-list odd">
                  <div class="chat-message">
                    <div class="chat-block">
                      <span>
                        <img class="img-circle" src="{{getProfileImage(message.fromUserId)}}">
                      </span>
                      <span [ngClass]="{'text': true, 'text-message': true, 'no-padding': isImage(message.content)}"
                        [innerHtml]="message.content"></span>
                    </div>
                    <span class="chat-date text-muted">{{message.time | customDate}}</span>
                  </div>
                </div>
                <div *ngIf="user.id == message.fromUserId" class="chat-list even">
                  <div class="chat-message">
                    <div class="chat-block">
                      <span [ngClass]="{'text': true, 'text-message': true, 'no-padding': isImage(message.content)}"
                        [innerHtml]="message.content"></span>
                    </div>
                    <span class="chat-date text-muted">{{message.time | customDate}}</span>
                  </div>
                </div>
              </div>

            </div>
            <!-- chat-footer -->
            <mat-card-actions class="chat-footer">
              <div class="chat-input-icon">
                <label>
                  <mat-icon>add_photo_alternate</mat-icon>
                  <input #imageInput class="display-none" type="file" accept="image/*"
                    (change)="processImage(imageInput)">
                </label>
              </div>
              <div class="chat-input-message">
                <mat-form-field>
                  <input matInput class="input-message" type="text" placeholder="Nhập tin nhắn" autocomplete="off"
                    [(ngModel)]="inputMessage" (keyup.enter)="sendMessage()" (focus)="seenConversation()">
                </mat-form-field>
                <button color="primary" class="button-send mat-fab mat-primary" (click)="sendMessage()">
                  <span class="mat-button-wrapper">
                    <mat-icon>send</mat-icon>
                  </span>
                </button>
              </div>
            </mat-card-actions>
          </div>

          <div class="col-lg-3 d-none d-lg-block d-xl-block chat-info-container">
            <!-- avatar -->
            <div class="avatar-section">
              <div>
                <img src="{{selectedConversation.avatar}}" alt="" class="img-circle-lg">
              </div>
              <div>
                <span class="user-display-name">{{selectedConversation.name}}</span>
              </div>
            </div>
            <div class="options-section">
              <!-- Expansion panel -->

              <!-- Thông tin -->
              <mat-accordion *ngIf="selectedConversation.type=='private'">
                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      Thông tin
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <p>
                    <mat-icon>person</mat-icon>
                    @{{selectedUser.userName}}
                  </p>
                  <p>
                    <mat-icon>offline_bolt</mat-icon>
                    <b>{{selectedUser.contributionPoint}}</b> điểm tích lũy
                  </p>
                  <p>
                    <mat-icon>rss_feed</mat-icon>
                    <b>{{selectedUser.followerCount}}</b> người theo dõi
                  </p>
                  <p *ngIf="selectedUser && selectedUser.address != ''">
                    <mat-icon>location_on</mat-icon>
                    {{selectedUser.address}}
                  </p>
                </mat-expansion-panel>
              </mat-accordion>

              <!-- Thao tác -->
              <mat-accordion>
                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      Thao tác
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <p class="action-item">
                    <mat-icon>block</mat-icon>
                    Chặn người dùng
                  </p>
                </mat-expansion-panel>
              </mat-accordion>

              <!-- Mọi người -->
              <mat-accordion *ngIf="selectedConversation.type=='group'">
                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      Mọi người
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <mat-nav-list>
                    <div *ngFor="let user of selectedConversation.users">
                      <mat-list-item class="chat-user-item">
                        <img class="mat-list-avatar" src="{{user.profileImage}}">
                        <div class="mat-list-text">
                          <h3 class="mat-line" matline="">{{user.displayName}}</h3>
                        </div>
                      </mat-list-item>
                    </div>
                  </mat-nav-list>
                </mat-expansion-panel>
              </mat-accordion>
            </div>
          </div>
        </div>
      </mat-card-content>


      <!--  -->
    </mat-sidenav-content>
  </mat-sidenav-container>
</mat-card>